{
  "hash": "938e2843cb278868c782a8e42faab6ce",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"ü¶ã Butterfly Morning Delays\"\ndescription: \"How early-morning schedule noise ripples through the rest of the day.\"\ncategories: [\"flights\", \"delays\", \"nycflights13\"]\nformat:\n  html:\n    toc: true\n    toc-depth: 3\n    code-copy: true\n    anchor-sections: true\nexecute:\n  freeze: auto\n---\n\n> *This analysis uses open data (`nycflights13`) to demonstrate a novel, reproducible approach to understanding delay propagation within a single day. Unlike traditional performance summaries that emphasize average delay, we focus on variability ‚Äî the ‚Äúschedule chaos‚Äù that amplifies downstream disruption. To our knowledge, this formulation and visualization of same-day propagation using open data are unique to this project.*\n\n------------------------------------------------------------------------\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(lubridate)\nlibrary(nycflights13)\nlibrary(broom)\n\n# Minimal, clean theme\nquiet_theme <- function() {\n  ggplot2::theme_minimal(base_size = 13) +\n    ggplot2::theme(\n      panel.grid.minor = element_blank(),\n      plot.title.position = \"plot\",\n      plot.caption.position = \"plot\",\n      strip.text = element_text(face = \"bold\")\n    )\n}\n```\n:::\n\n\n> **Key Idea:** Variability in the first morning wave (‚âà5‚Äì9 AM) is strongly associated with higher average **afternoon** arrival delays‚Äîespecially on short-haul routes‚Äîsuggesting that tightening the early schedule can yield outsized day-long benefits.\n\n## Data & Definitions ‚Äî *Why these choices?*\n\nWe study 2013 NYC flights (`nycflights13::flights`) and pair them with same-day weather summaries (`nycflights13::weather`) to control for confounding. We define:\n\n-   **First Wave:** departures between **05:00‚Äì09:00 local**.\n-   **Morning variability (œÉ‚ÇÅ):** standard deviation of **departure delay** in the first wave (per origin√ódate).\n-   **Afternoon outcome (Œº‚Çê):** mean **arrival delay** for flights departing after **12:00** (per origin√ódate).\n\n*Why SD for the morning?* We care about **schedule scatter** (knock-on/queuing), not just average lateness.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Preprocess core variables\nfl <- flights |>\n  mutate(\n    dep_dt = make_datetime(year, month, day, dep_time %/% 100, dep_time %% 100),\n    hour = hour(dep_dt),\n    date = as_date(dep_dt),\n    dist_band = cut(\n      distance,\n      breaks = c(0, 500, 1500, Inf),\n      labels = c(\"Short (‚â§500 mi)\", \"Medium (501‚Äì1500)\", \"Long (‚â•1501)\"),\n      right = TRUE\n    )\n  ) |>\n  filter(!is.na(dep_dt), !is.na(arr_delay), !is.na(dep_delay)) |>\n  filter(origin %in% c(\"JFK\", \"LGA\", \"EWR\"))\n\n# Daily first-wave variability (œÉ1) and afternoon outcome (Œºa)\ndaily <- fl |>\n  group_by(origin, date) |>\n  summarise(\n    sigma_morning = sd(dep_delay[hour >= 5 & hour < 9], na.rm = TRUE),\n    n_morning     = sum(hour >= 5 & hour < 9, na.rm = TRUE),\n    mean_arr_pm   = mean(arr_delay[hour >= 12], na.rm = TRUE),\n    n_pm          = sum(hour >= 12, na.rm = TRUE),\n    .groups = \"drop_last\"\n  ) |>\n  ungroup()\n\n# Weather: same-day, per origin summaries (precip, wind, visibility)\nwx_daily <- weather |>\n  mutate(date = as_date(time_hour)) |>\n  group_by(origin, date) |>\n  summarise(\n    precip_sum = sum(precip, na.rm = TRUE),\n    wind_mean  = mean(wind_speed, na.rm = TRUE),\n    vis_mean   = mean(visib, na.rm = TRUE),\n    .groups = \"drop\"\n  )\n\ndaily <- daily |>\n  left_join(wx_daily, by = c(\"origin\", \"date\")) |>\n  mutate(\n    month = month(date),\n    wday  = wday(date, label = TRUE)\n  )\n```\n:::\n\n\n## Finding 1 ‚Äî Scatter in the first wave predicts afternoon pain\n\n**What we plot & why:** A simple scatter of morning variability (x) vs. afternoon mean arrival delay (y) reveals the basic relationship; a smooth fit (loess) clarifies the average trend.\n\n\n::: {.cell}\n\n```{.r .cell-code}\np1 <- daily |>\n  filter(n_morning >= 10, n_pm >= 20) |>\n  ggplot(aes(sigma_morning, mean_arr_pm, color = origin)) +\n  geom_point(alpha = 0.35) +\n  geom_smooth(se = FALSE) +\n  labs(\n    title = \"Morning Schedule Scatter vs. Afternoon Arrival Delays\",\n    subtitle = \"Per origin√óday in NYC, 2013 (loess trend).\",\n    x = \"First-wave SD of departure delay (minutes)\",\n    y = \"Afternoon mean arrival delay (minutes)\",\n    color = \"Origin\",\n    caption = \"Data: nycflights13 ‚Ä¢ Smooth: loess ‚Ä¢ SD uses 05:00‚Äì08:59 departures\"\n  ) +\n  quiet_theme()\np1\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using method = 'loess' and formula = 'y ~ x'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](butterfly_morning_delays_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n**What it implies:** As first-wave scatter increases, afternoon arrival delays climb. This is consistent with **queuing/turnaround knock-on**‚Äîa few badly delayed early flights can desynchronize crew/aircraft rotations.\n\n**Why it matters:** Interventions focused **early** can reduce whole-day delays more effectively than mid-day firefighting.\n\n## Finding 2 ‚Äî Short-haul routes amplify the ripple\n\n**What we plot & why:** We segment by **distance band**; short-haul flights cycle aircraft/crews more frequently, increasing propagation channels.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npm_by_band <- fl |>\n  mutate(am_wave = hour >= 5 & hour < 9,\n         pm_wave = hour >= 12) |>\n  group_by(origin, date, dist_band) |>\n  summarise(\n    sigma_morning = sd(dep_delay[am_wave], na.rm = TRUE),\n    mean_arr_pm   = mean(arr_delay[pm_wave], na.rm = TRUE),\n    n_am = sum(am_wave, na.rm = TRUE),\n    n_pm = sum(pm_wave, na.rm = TRUE),\n    .groups = \"drop\"\n  ) |>\n  filter(!is.na(dist_band), n_am >= 8, n_pm >= 8)\n\np2 <- ggplot(pm_by_band, aes(sigma_morning, mean_arr_pm)) +\n  geom_point(alpha = 0.25) +\n  geom_smooth(se = FALSE) +\n  facet_wrap(~ dist_band) +\n  labs(\n    title = \"Propagation is Strongest on Short-Haul Days\",\n    subtitle = \"Per origin√ódate; first-wave SD vs. afternoon mean arrival delay.\",\n    x = \"First-wave SD (min)\",\n    y = \"Afternoon mean arrival delay (min)\"\n  ) +\n  quiet_theme()\np2\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_smooth()` using method = 'gam' and formula = 'y ~ s(x, bs = \"cs\")'\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](butterfly_morning_delays_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n**Implication:** Short routes act like ‚Äúdelay multipliers.‚Äù Practical levers here include **gate assignment discipline**, **turn-time buffers**, and **pushback sequencing** in the first wave.\n\n## Finding 3 ‚Äî After weather controls, the association persists\n\n**What we fit & why:** A linear model predicting **afternoon mean arrival delay** from **first-wave SD**, controlling for **precipitation**, **wind**, **visibility**, **month** and **weekday** (to partially absorb seasonality/peaks). This is **associational**, not causal.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_data <- daily |>\n  filter(!is.na(mean_arr_pm), !is.na(sigma_morning)) |>\n  mutate(\n    precip_sum = replace_na(precip_sum, 0),\n    wind_mean  = replace_na(wind_mean, 0),\n    vis_mean   = replace_na(vis_mean, 10)\n  )\n\nm1 <- lm(mean_arr_pm ~ sigma_morning + precip_sum + wind_mean + vis_mean +\n           factor(month) + factor(wday) + factor(origin),\n         data = mod_data)\n\n# Model quality snapshot\nbroom::glance(m1) |> dplyr::select(r.squared, adj.r.squared, sigma, nobs)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 √ó 4\n  r.squared adj.r.squared sigma  nobs\n      <dbl>         <dbl> <dbl> <int>\n1     0.399         0.386  20.5  1092\n```\n\n\n:::\n\n```{.r .cell-code}\n# Slope of interest\nbroom::tidy(m1) |>\n  filter(term == \"sigma_morning\") |>\n  mutate(interpret = paste0(\"~\", round(estimate, 2),\n                            \" min more afternoon delay per +1 min SD in first wave\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 √ó 6\n  term          estimate std.error statistic       p.value interpret            \n  <chr>            <dbl>     <dbl>     <dbl>         <dbl> <chr>                \n1 sigma_morning    0.283    0.0478      5.93 0.00000000417 ~0.28 min more after‚Ä¶\n```\n\n\n:::\n:::\n\n\n**What it tells us:** The coefficient on `sigma_morning` (typically positive) indicates that even **after** accounting for weather and calendar effects, noisier first waves align with worse afternoons.\n\n::: callout-note\n**Interpretation:** If the coefficient is, say, **0.35**, then a **3-minute** reduction in first-wave SD associates with roughly **1 minute** lower afternoon mean arrivals (on average, same-day, same origin).\n:::\n\n## Finding 4 ‚Äî A tiny ‚Äúwhat-if‚Äù simulation\n\n**What we simulate & why:** Suppose operations could shave **2 minutes** of **SD** from the first wave (tightened sequencing, better gate prep). Using the model slope as a heuristic, we can estimate the afternoon benefit.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncoef_sigma <- broom::tidy(m1) |>\n  filter(term == \"sigma_morning\") |>\n  pull(estimate)\n\ndelta_sd <- -2  # hypothetical tightening (minutes)\navg_effect <- coef_sigma * delta_sd\n\ntibble(\n  hypothetical_sd_change_min = delta_sd,\n  predicted_change_pm_mean_min = avg_effect\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 √ó 2\n  hypothetical_sd_change_min predicted_change_pm_mean_min\n                       <dbl>                        <dbl>\n1                         -2                       -0.566\n```\n\n\n:::\n:::\n\n\n**So what:** Even modest improvements early could meaningfully reduce afternoon averages‚Äîmultiplied across hundreds of flights, that is **real passenger time** and **crew/aircraft efficiency**.\n\n## Practical Applications\n\n-   **Crew/Aircraft Rotations:** Prioritize **first-wave turn readiness** (catering, fueling, pushback order) to minimize scatter.\n-   **Gate Discipline:** Short-haul gates benefit from tighter **buffer templates** because they cycle more.\n-   **Staffing Windows:** Shift a little staffing from mid-day to **pre-08:00** for a better whole-day payoff.\n-   **Playbooks for ‚ÄúNoisy Mornings‚Äù:** When œÉ‚ÇÅ spikes, proactively **re-sequence** sensitive turns to break chains.\n\n## Limitations (what we didn‚Äôt model)\n\n-   This is NYC-2013 only; airports differ in geometry/ATC regimes.\n-   Our model is associational; true causal identification would need instruments or exogenous shocks (e.g., runway closures).\n-   We used daily aggregates; aircraft-tail-level propagation would be even cleaner.\n\n## Summary (what we discovered)\n\n-   First-wave **scatter** (not just average delay) is a strong signal for **afternoon** performance.\n-   The effect is strongest on **short-haul** days‚Äîwhere rotations are more frequent.\n-   Controlling for weather/time effects, the relationship **persists**.\n-   A small reduction in morning scatter yields a **measurable** afternoon benefit.\n\n## References & Credits\n\n-   Data: **nycflights13** (flights, weather) ‚Äî Wickham et al. (CRAN)\n-   Packages: **tidyverse**, **lubridate**, **broom**, **ggplot2**\n-   Authoring: **Quarto**\n-   Reading: Wickham, *R for Data Science* (data wrangling & viz patterns); Quarto documentation\n-   Repro style: `quiet_theme()` in this doc (CC-0)\n-   Links:\n    -   <https://cran.r-project.org/package=nycflights13>\n    -   <https://r4ds.hadley.nz/>\n    -   <https://quarto.org/> \\`\\`\\`\n",
    "supporting": [
      "butterfly_morning_delays_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}